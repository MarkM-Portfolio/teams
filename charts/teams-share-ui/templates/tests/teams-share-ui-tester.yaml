apiVersion: v1
kind: Pod

metadata:
  name: {{ template "name" .  }}-test
  namespace: {{ .Values.namespace }}
  annotations:
    "helm.sh/hook": test-success

spec:
  containers:
  - name: {{ template "name" . }}-tester
    image: {{ .Values.image.repository }}/{{ template "name" . }}-tester:{{ .Values.image.tag }}
    imagePullPolicy: {{ default "IfNotPresent" .Values.image.pullPolicy }}

    env:
    command: ["sh", "-c", "/home/ibm/app/tests/runtests.sh"]
    resources:
        limits:
          cpu: {{ .Values.resources.tester.limits.cpu }}
          memory: {{ .Values.resources.tester.limits.memory }}
        requests:
          cpu: {{ .Values.resources.tester.requests.cpu }}
          memory: {{ .Values.resources.tester.requests.memory }}
  restartPolicy: Never
